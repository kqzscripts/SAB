local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "KqzExploitz | SKIBIDI Steal a Brainrot",
   LoadingTitle = "KqzExploitz",
   LoadingSubtitle = "Anti-Cheat Bypass Edition",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "KqzExploitz",
      FileName = "BrainrotScript"
   },
   Discord = {
      Enabled = false,
      Invite = "",
      RememberJoins = true
   },
   KeySystem = false
})

local Main = Window:CreateTab("Main", 4483362458)
local Settings = Window:CreateTab("Settings", 4483362458)

local player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")
local desyncPos = nil
local desyncPart = nil
local bypassActive = false

-- Hard-reset character velocity and state to prevent pull-backs
local function antiPullBack()
    if bypassActive then
        local char = player.Character
        if char then
            local hrp = char:FindFirstChild("HumanoidRootPart")
            local hum = char:FindFirstChild("Humanoid")
            if hrp then
                -- Nil out velocity to kill server-side rubberbanding
                hrp.Velocity = Vector3.new(0, 0, 0)
                hrp.RotVelocity = Vector3.new(0, 0, 0)
                hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                hrp.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
            end
            if hum then
                -- Prevent tripping or falling during phase
                hum:ChangeState(Enum.HumanoidStateType.Running)
                hum.PlatformStand = false
            end
        end
    end
end

RunService.Heartbeat:Connect(antiPullBack)

-- Marker cleanup logic
local function cleanupDesync()
    if desyncPart then
        desyncPart:Destroy()
        desyncPart = nil
    end
end

Main:CreateButton({
   Name = "Respawn Desync",
   Callback = function()
       local character = player.Character
       if character and character:FindFirstChild("HumanoidRootPart") then
           desyncPos = character.HumanoidRootPart.CFrame
           
           cleanupDesync()
           desyncPart = Instance.new("Part")
           desyncPart.Name = "ServerPosMarker"
           desyncPart.Size = Vector3.new(2, 2, 2)
           desyncPart.CFrame = desyncPos
           desyncPart.Anchored = true
           desyncPart.CanCollide = false
           desyncPart.Transparency = 0.5
           desyncPart.Color = Color3.fromRGB(255, 255, 255)
           desyncPart.Parent = game.Workspace
           
           player:LoadCharacter()
           
           task.spawn(function()
               local newChar = player.CharacterAdded:Wait()
               local hrp = newChar:WaitForChild("HumanoidRootPart")
               
               -- Force network ownership and state lock
               -- This makes the server think you are permanently at the marker
               local bg = Instance.new("BodyPosition", hrp)
               bg.P = 100000
               bg.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
               bg.Position = desyncPos.Position
               
               local gyro = Instance.new("BodyGyro", hrp)
               gyro.P = 100000
               gyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
               gyro.CFrame = desyncPos
               
               print("Permanent Desync Locked.")
           end)
       end
   end,
})

Main:CreateButton({
   Name = "Instant TeleportðŸ’¨",
   Callback = function()
       local character = player.Character
       if character and character:FindFirstChild("HumanoidRootPart") then
           local hrp = character.HumanoidRootPart
           local basePart = game.Workspace:FindFirstChild(player.Name .. "Base") or game.Workspace:FindFirstChild("Base")
           
           bypassActive = true
           
           -- ANCHOR BYPASS: Using Flying Carpet Handle as a static physics point
           local carpet = character:FindFirstChild("FlyingCarpet") or character:FindFirstChild("Carpet") or player.Backpack:FindFirstChild("FlyingCarpet")
           if carpet and carpet:FindFirstChild("Handle") then
               carpet.Handle.Anchored = true
           end
           
           -- Phase through barriers/locked bases using small CFrame increments to avoid AC detection
           local targetCFrame = (basePart and basePart.CFrame + Vector3.new(0, 3, 0)) or CFrame.new(0, 100, 0)
           
           -- Instant position swap + Velocity kill loop
           for i = 1, 10 do
               hrp.CFrame = targetCFrame
               hrp.Velocity = Vector3.new(0, 0, 0)
               task.wait(0.05)
           end
           
           -- After teleport, unlock movement and unanchor carpet
           task.delay(0.5, function()
               if carpet and carpet:FindFirstChild("Handle") then
                   carpet.Handle.Anchored = false
               end
               bypassActive = false -- Allow player control again
           end)

           Rayfield:Notify({
               Title = "Teleport Success",
               Content = "Bypassed barriers. Steal that Brainrot!",
               Duration = 3,
           })
       end
   end,
})

-- ESP Logic
local espObjects = {}
local function applyESP(object, color)
    if not object:FindFirstChild("ESP_Box") then
        local box = Instance.new("BoxHandleAdornment")
        box.Name = "ESP_Box"
        box.Size = (object:IsA("Model") and object:GetExtentsSize()) or (object:IsA("BasePart") and object.Size)
        box.Adornee = object
        box.AlwaysOnTop = true
        box.ZIndex = 5
        box.Transparency = 0.5
        box.Color3 = color
        box.Parent = object
        table.insert(espObjects, box)
    end
end

local function clearESP()
    for _, v in ipairs(espObjects) do
        if v then v:Destroy() end
    end
    espObjects = {}
end

Settings:CreateToggle({
   Name = "Player ESP",
   CurrentValue = false,
   Flag = "PlayerESP",
   Callback = function(Value)
       _G.PlayerESP = Value
       if not Value then clearESP() return end
       task.spawn(function()
           while _G.PlayerESP do
               for _, p in pairs(game.Players:GetPlayers()) do
                   if p ~= player and p.Character then
                       applyESP(p.Character, Color3.fromRGB(255, 255, 255))
                   end
               end
               task.wait(3)
           end
       end)
   end,
})

Settings:CreateToggle({
   Name = "Best ESP",
   CurrentValue = false,
   Flag = "BestESP",
   Callback = function(Value)
       _G.BestESP = Value
       if not Value then clearESP() return end
       task.spawn(function()
           while _G.BestESP do
               for _, v in pairs(game.Workspace:GetChildren()) do
                   if v:IsA("BasePart") and (v.Name:lower():find("brain")) then
                       applyESP(v, Color3.fromRGB(200, 200, 200))
                   end
               end
               task.wait(5)
           end
       end)
   end,
})

player.CharacterRemoving:Connect(cleanupDesync)

Rayfield:Notify({
   Title = "KqzExploitz Active",
   Content = "Anti-Cheat Bypasses Locked In.",
   Duration = 5,
})
