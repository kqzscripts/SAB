local player = game.Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Cleanup existing UI
local existing = CoreGui:FindFirstChild("KqzExploitzUI")
if existing then existing:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KqzExploitzUI"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false

-- State Variables
local desyncPos = nil
local desyncPart = nil
local bypassActive = false
local playerESP = false
local bestESP = false
local espObjects = {}

-- App-style Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 500, 0, 350)
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 15)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(60, 60, 60)
UIStroke.Thickness = 1.5
UIStroke.Parent = MainFrame

-- Header
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Size = UDim2.new(1, 0, 0, 60)
Header.BackgroundTransparency = 1
Header.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -20, 1, 0)
Title.Position = UDim2.new(0, 20, 0, 0)
Title.Text = "KqzExploitz"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 24
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.BackgroundTransparency = 1
Title.Parent = Header

-- Content Tabs
local TabContainer = Instance.new("Frame")
TabContainer.Size = UDim2.new(0, 120, 1, -60)
TabContainer.Position = UDim2.new(0, 0, 0, 60)
TabContainer.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
TabContainer.BorderSizePixel = 0
TabContainer.Parent = MainFrame

local TabCorner = Instance.new("UICorner")
TabCorner.CornerRadius = UDim.new(0, 15)
TabCorner.Parent = TabContainer

local PageContainer = Instance.new("Frame")
PageContainer.Size = UDim2.new(1, -130, 1, -70)
PageContainer.Position = UDim2.new(0, 125, 0, 65)
PageContainer.BackgroundTransparency = 1
PageContainer.Parent = MainFrame

local function createPage(name)
    local page = Instance.new("ScrollingFrame")
    page.Name = name
    page.Size = UDim2.new(1, 0, 1, 0)
    page.BackgroundTransparency = 1
    page.CanvasSize = UDim2.new(0, 0, 0, 0)
    page.ScrollBarThickness = 2
    page.Visible = false
    page.Parent = PageContainer
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 10)
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layout.Parent = page
    
    return page
end

local MainPage = createPage("Main")
local SettingsPage = createPage("Settings")
MainPage.Visible = true

-- Advanced Modeled Button Function
local function createButton(parent, text, callback)
    local btnFrame = Instance.new("Frame")
    btnFrame.Size = UDim2.new(0.9, 0, 0, 50)
    btnFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    btnFrame.Parent = parent

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = btnFrame

    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(50, 50, 50)
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Parent = btnFrame

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundTransparency = 1
    button.Text = text
    button.TextColor3 = Color3.fromRGB(220, 220, 220)
    button.Font = Enum.Font.GothamSemibold
    button.TextSize = 16
    button.Parent = btnFrame

    button.MouseEnter:Connect(function()
        TweenService:Create(btnFrame, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(45, 45, 45)}):Play()
    end)
    button.MouseLeave:Connect(function()
        TweenService:Create(btnFrame, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(30, 30, 30)}):Play()
    end)
    button.MouseButton1Down:Connect(function()
        btnFrame:TweenSize(UDim2.new(0.85, 0, 0, 45), "Out", "Quad", 0.1, true)
        callback()
    end)
    button.MouseButton1Up:Connect(function()
        btnFrame:TweenSize(UDim2.new(0.9, 0, 0, 50), "Out", "Quad", 0.1, true)
    end)
end

-- Anti-Cheat Logic Persistence
RunService.Heartbeat:Connect(function()
    if bypassActive then
        local char = player.Character
        if char then
            local hrp = char:FindFirstChild("HumanoidRootPart")
            if hrp then
                hrp.Velocity = Vector3.new(0, 0, 0)
                hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
            end
        end
    end
end)

-- Features
createButton(MainPage, "Respawn Desync", function()
    local char = player.Character
    if char and char:FindFirstChild("Humanoid") then
        char.Humanoid.Health = 0
        task.spawn(function()
            local newChar = player.CharacterAdded:Wait()
            local hrp = newChar:WaitForChild("HumanoidRootPart")
            desyncPos = hrp.CFrame
            if desyncPart then desyncPart:Destroy() end
            desyncPart = Instance.new("Part")
            desyncPart.Size = Vector3.new(2, 6, 2)
            desyncPart.CFrame = desyncPos
            desyncPart.Color = Color3.fromRGB(255, 255, 255)
            desyncPart.Material = Enum.Material.Neon
            desyncPart.Anchored = true
            desyncPart.CanCollide = false
            desyncPart.Parent = game.Workspace
            
            local bp = Instance.new("BodyPosition", hrp)
            bp.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            bp.Position = desyncPos.Position
        end)
    end
end)

createButton(MainPage, "Instant TeleportðŸ’¨", function()
    local char = player.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        bypassActive = true
        local hrp = char.HumanoidRootPart
        local base = game.Workspace:FindFirstChild(player.Name.."Base") or game.Workspace:FindFirstChild("Base")
        local carpet = char:FindFirstChild("FlyingCarpet") or char:FindFirstChild("Carpet")
        if carpet and carpet:FindFirstChild("Handle") then carpet.Handle.Anchored = true end
        
        for i = 1, 15 do
            hrp.CFrame = (base and base.CFrame + Vector3.new(0, 3, 0)) or CFrame.new(0, 100, 0)
            task.wait(0.05)
        end
        
        if carpet and carpet:FindFirstChild("Handle") then carpet.Handle.Anchored = false end
        bypassActive = false
    end
end)

-- ESP System (Simplified)
local function updateESP()
    for _, obj in pairs(espObjects) do if obj then obj:Destroy() end end
    espObjects = {}
    if playerESP then
        for _, p in pairs(game.Players:GetPlayers()) do
            if p ~= player and p.Character then
                local b = Instance.new("BoxHandleAdornment", p.Character)
                b.Size = p.Character:GetExtentsSize()
                b.Adornee = p.Character
                b.AlwaysOnTop = true
                b.Color3 = Color3.fromRGB(255, 255, 255)
                b.Transparency = 0.5
                table.insert(espObjects, b)
            end
        end
    end
end

createButton(SettingsPage, "Toggle Player ESP", function()
    playerESP = not playerESP
    updateESP()
end)

-- Draggable
local dragging, dragInput, dragStart, startPos
MainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = MainFrame.Position
	end
end)
UserInputService.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)
UserInputService.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
	end
end)
RunService.RenderStepped:Connect(function()
	if dragging and dragInput then
		local delta = dragInput.Position - dragStart
		MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)

