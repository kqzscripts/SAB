-- KqzExploitz
-- Custom Built UI (No Library)
-- Features: Set Checkpoint, Auto TP
-- Optimized for: Steal a Brainrot / Bunni.lol

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer

-- ================= STATE =================
local SavedCheckpoint = nil
local CheckpointVisual = nil
local DesyncConnection = nil
local AutoTPActive = false

-- ================= CLEANUP =================
local existing = CoreGui:FindFirstChild("KqzExploitzUI")
if existing then existing:Destroy() end

local workspace = game:GetService("Workspace")
local oldVisual = workspace:FindFirstChild("KqzExploitz_CheckpointMarker")
if oldVisual then oldVisual:Destroy() end

-- ================= GUI SETUP =================
local gui = Instance.new("ScreenGui")
gui.Name = "KqzExploitzUI"
gui.ResetOnSpawn = false
gui.Parent = CoreGui
gui.DisplayOrder = 999999

pcall(function() gui.IgnoreGuiInset = true end)

local Main = Instance.new("Frame", gui)
Main.Size = UDim2.new(0, 320, 0, 310)
Main.Position = UDim2.fromScale(0.5, 0.5)
Main.AnchorPoint = Vector2.new(0.5, 0.5)
Main.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Main.BorderSizePixel = 0
Main.Active = true
Instance.new("UICorner", Main)

-- Title Bar
local TitleBar = Instance.new("Frame", Main)
TitleBar.Size = UDim2.new(1, 0, 0, 36)
TitleBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
TitleBar.BorderSizePixel = 0
Instance.new("UICorner", TitleBar)

local TitleText = Instance.new("TextLabel", TitleBar)
TitleText.Size = UDim2.new(1, -70, 1, 0)
TitleText.Position = UDim2.new(0, 12, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "KqzExploitz"
TitleText.Font = Enum.Font.GothamBold
TitleText.TextSize = 16
TitleText.TextColor3 = Color3.new(1, 1, 1)
TitleText.TextXAlignment = Enum.TextXAlignment.Left

-- Controls (Minimize/Close)
local MinBtn = Instance.new("TextButton", TitleBar)
MinBtn.Size = UDim2.new(0, 24, 0, 24)
MinBtn.Position = UDim2.new(1, -58, 0, 6)
MinBtn.Text = "-"
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextSize = 18
MinBtn.TextColor3 = Color3.new(1, 1, 1)
MinBtn.BackgroundColor3 = Color3.fromRGB(65, 65, 65)
Instance.new("UICorner", MinBtn)

local CloseBtn = Instance.new("TextButton", TitleBar)
CloseBtn.Size = UDim2.new(0, 24, 0, 24)
CloseBtn.Position = UDim2.new(1, -28, 0, 6)
CloseBtn.Text = "X"
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 14
CloseBtn.TextColor3 = Color3.new(1, 1, 1)
CloseBtn.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
Instance.new("UICorner", CloseBtn)

-- Content Area
local Content = Instance.new("Frame", Main)
Content.Position = UDim2.new(0, 10, 0, 46)
Content.Size = UDim2.new(1, -20, 1, -56)
Content.BackgroundTransparency = 1

local Layout = Instance.new("UIListLayout", Content)
Layout.Padding = UDim.new(0, 10)
Layout.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- ================= DRAGGING =================
do
    local dragging, dragStart, startPos
    TitleBar.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = i.Position
            startPos = Main.Position
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then
            local delta = i.Position - dragStart
            Main.Position = startPos + UDim2.fromOffset(delta.X, delta.Y)
        end
    end)
    UIS.InputEnded:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
end

-- ================= MINIMIZE LOGIC =================
local isMin = false
MinBtn.MouseButton1Click:Connect(function()
    isMin = not isMin
    Content.Visible = not isMin
    TweenService:Create(Main, TweenInfo.new(0.2), {Size = isMin and UDim2.new(0, 320, 0, 36) or UDim2.new(0, 320, 0, 310)}):Play()
end)

CloseBtn.MouseButton1Click:Connect(function()
    gui:Destroy()
    if CheckpointVisual then CheckpointVisual:Destroy() end
end)

-- ================= UI HELPERS =================
local function CreateButton(text, callback)
    local b = Instance.new("TextButton", Content)
    b.Size = UDim2.new(1, 0, 0, 42)
    b.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    b.Text = text
    b.Font = Enum.Font.GothamSemibold
    b.TextSize = 14
    b.TextColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", b)
    
    b.MouseButton1Click:Connect(function()
        callback(b)
    end)
    return b
end

local function CreateToggle(text, callback)
    local active = false
    local b = CreateButton(text .. ": OFF", function(btn)
        active = not active
        btn.Text = text .. ": " .. (active and "ON" or "OFF")
        btn.BackgroundColor3 = active and Color3.fromRGB(90, 90, 90) or Color3.fromRGB(60, 60, 60)
        callback(active)
    end)
    return b
end

-- ================= FEATURES =================

-- Set Checkpoint
CreateButton("Set Checkpoint", function()
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if hrp then
        SavedCheckpoint = hrp.Position
        
        -- Marker Visual
        if CheckpointVisual then CheckpointVisual:Destroy() end
        local marker = Instance.new("Part")
        marker.Name = "KqzExploitz_CheckpointMarker"
        marker.Size = Vector3.new(2, 6, 2)
        marker.Position = SavedCheckpoint
        marker.Anchored = true
        marker.CanCollide = false
        marker.Color = Color3.fromRGB(200, 200, 200)
        marker.Transparency = 0.5
        marker.Material = Enum.Material.SmoothPlastic
        marker.Parent = workspace
        
        local mesh = Instance.new("SpecialMesh", marker)
        mesh.MeshType = Enum.MeshType.Brick
        
        CheckpointVisual = marker
        
        -- Anti-Die Jitter
        if DesyncConnection then DesyncConnection:Disconnect() end
        DesyncConnection = RunService.Heartbeat:Connect(function()
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.Velocity = Vector3.new(0, 0.05, 0)
            end
        end)
    end
end)

-- Auto TP
CreateToggle("Auto TP", function(state)
    AutoTPActive = state
    if state then
        task.spawn(function()
            while AutoTPActive do
                local char = player.Character
                local hrp = char and char:FindFirstChild("HumanoidRootPart")
                if hrp and SavedCheckpoint then
                    local tool = char:FindFirstChildOfClass("Tool")
                    if tool and tool.Name ~= "Flying Carpet" then
                        local carpet = char:FindFirstChild("Flying Carpet") or player.Backpack:FindFirstChild("Flying Carpet")
                        if carpet then
                            carpet.Parent = char
                            task.wait(0.05)
                            hrp.CFrame = CFrame.new(SavedCheckpoint)
                            hrp.Velocity = Vector3.new(0, 0, 0)
                        end
                    end
                end
                task.wait(0.1)
            end
        end)
    end
end)

-- ================= TOGGLE KEYBIND =================
UIS.InputBegan:Connect(function(input, gpe)
    if not gpe and input.KeyCode == Enum.KeyCode.RightShift then
        gui.Enabled = not gui.Enabled
    end
end)

print("[KqzExploitz] Loaded successfully with custom UI.")
