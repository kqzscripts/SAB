-- KqzExploitz Utility Hub
-- Features: Save Checkpoint, Teleport Back (Carpet Required)
-- UI: Grey / Dark Grey / White

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- ================= STATE =================
local SavedPosition = nil

-- ================= CLEANUP =================
local pg = player:WaitForChild("PlayerGui")
local old = pg:FindFirstChild("KqzExploitzUI")
if old then old:Destroy() end

-- ================= GUI =================
local gui = Instance.new("ScreenGui")
gui.Name = "KqzExploitzUI"
gui.ResetOnSpawn = false
gui.Parent = pg

local Main = Instance.new("Frame", gui)
Main.Size = UDim2.new(0, 320, 0, 220)
Main.Position = UDim2.fromScale(0.5, 0.5)
Main.AnchorPoint = Vector2.new(0.5, 0.5)
Main.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Main.Active = true
Instance.new("UICorner", Main)

-- ================= DRAG =================
do
    local dragging, startPos, startInput
    Main.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            startInput = i.Position
            startPos = Main.Position
            i.Changed:Connect(function()
                if i.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UIS.InputChanged:Connect(function(i)
        if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = i.Position - startInput
            Main.Position = startPos + UDim2.fromOffset(delta.X, delta.Y)
        end
    end)
end

-- ================= TITLE BAR =================
local Title = Instance.new("Frame", Main)
Title.Size = UDim2.new(1, 0, 0, 36)
Title.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Instance.new("UICorner", Title)

local TitleText = Instance.new("TextLabel", Title)
TitleText.Size = UDim2.new(1, -70, 1, 0)
TitleText.Position = UDim2.new(0, 12, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "KqzExploitz"
TitleText.Font = Enum.Font.GothamBold
TitleText.TextSize = 16
TitleText.TextColor3 = Color3.new(1, 1, 1)
TitleText.TextXAlignment = Enum.TextXAlignment.Left

local Close = Instance.new("TextButton", Title)
Close.Size = UDim2.new(0, 22, 0, 22)
Close.Position = UDim2.new(1, -28, 0, 7)
Close.Text = "X"
Close.Font = Enum.Font.GothamBold
Close.TextSize = 14
Close.BackgroundColor3 = Color3.fromRGB(170, 60, 60)
Close.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", Close)

Close.MouseButton1Click:Connect(function()
    gui:Destroy()
end)

-- ================= CONTENT =================
local Content = Instance.new("Frame", Main)
Content.Position = UDim2.new(0, 10, 0, 50)
Content.Size = UDim2.new(1, -20, 1, -60)
Content.BackgroundTransparency = 1

local layout = Instance.new("UIListLayout", Content)
layout.Padding = UDim.new(0, 10)

-- ================= HELPERS =================
local function Button(text, callback)
    local b = Instance.new("TextButton", Content)
    b.Size = UDim2.new(1, 0, 0, 42)
    b.Text = text
    b.Font = Enum.Font.GothamSemibold
    b.TextSize = 14
    b.TextColor3 = Color3.new(1,1,1)
    b.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    Instance.new("UICorner", b)
    b.MouseButton1Click:Connect(callback)
end

-- ================= DETECTION =================
local function HasCarriedObject()
    local char = player.Character
    if not char then return false end

    for _, v in ipairs(char:GetChildren()) do
        if v:IsA("Model") and v ~= char then
            return true
        end
        if v:IsA("BasePart") and not v.Name:lower():find("humanoid") then
            if not v.Name:lower():find("carpet") then
                return true
            end
        end
    end
    return false
end

local function GetFlyingCarpet()
    local char = player.Character
    if not char then return nil end

    for _, v in ipairs(char:GetChildren()) do
        if v:IsA("Tool") and v.Name:lower():find("carpet") then
            return v
        end
    end
end

-- ================= FEATURES =================
Button("Save Checkpoint", function()
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if hrp then
        SavedPosition = hrp.CFrame
        warn("[KqzExploitz] Checkpoint saved")
    end
end)

Button("Teleport To Checkpoint", function()
    if not SavedPosition then return end
    if not HasCarriedObject() then return end

    local carpet = GetFlyingCarpet()
    if not carpet then return end

    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    local hum = player.Character and player.Character:FindFirstChild("Humanoid")

    if hrp and hum then
        hum:ChangeState(Enum.HumanoidStateType.Physics)
        hrp.Velocity = Vector3.zero
        hrp.CFrame = SavedPosition
        task.wait()
        hum:ChangeState(Enum.HumanoidStateType.Running)
    end
end)

print("[KqzExploitz] Loaded successfully")
