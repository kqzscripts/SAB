-- KqzExploitz Custom UI (No Library)
-- Grey/Dark Grey/White Theme
-- Draggable and Organized

local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local TitleBar = Instance.new("Frame")
local TitleLabel = Instance.new("TextLabel")
local CloseButton = Instance.new("TextButton")
local MinimizeButton = Instance.new("TextButton")
local ContentFrame = Instance.new("ScrollingFrame")
local UIListLayout = Instance.new("UIListLayout")

-- Values
local DesyncEnabled = false
local ServerPosPart = nil
local SavedCheckpoint = nil
local TeleportActive = false

-- Setup ScreenGui
ScreenGui.Name = "KqzExploitzUI"
ScreenGui.Parent = game:GetService("CoreGui")
ScreenGui.ResetOnSpawn = false

-- Setup Main Frame
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30) -- Dark Grey
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -150)
MainFrame.Size = UDim2.new(0, 300, 0, 350)
MainFrame.Active = true
MainFrame.Draggable = true

-- Setup Title Bar
TitleBar.Name = "TitleBar"
TitleBar.Parent = MainFrame
TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 45) -- Grey
TitleBar.BorderSizePixel = 0
TitleBar.Size = UDim2.new(1, 0, 0, 30)

TitleLabel.Name = "TitleLabel"
TitleLabel.Parent = TitleBar
TitleLabel.BackgroundTransparency = 1
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.Size = UDim2.new(1, -70, 1, 0)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Text = "KqzExploitz"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255) -- White
TitleLabel.TextSize = 14
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Close and Minimize
CloseButton.Name = "CloseButton"
CloseButton.Parent = TitleBar
CloseButton.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
CloseButton.Position = UDim2.new(1, -30, 0, 5)
CloseButton.Size = UDim2.new(0, 20, 0, 20)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Parent = TitleBar
MinimizeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
MinimizeButton.Position = UDim2.new(1, -55, 0, 5)
MinimizeButton.Size = UDim2.new(0, 20, 0, 20)
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)

local minimized = false
MinimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    ContentFrame.Visible = not minimized
    MainFrame.Size = minimized and UDim2.new(0, 300, 0, 30) or UDim2.new(0, 300, 0, 350)
end)

-- Content Frame
ContentFrame.Name = "ContentFrame"
ContentFrame.Parent = MainFrame
ContentFrame.BackgroundTransparency = 1
ContentFrame.Position = UDim2.new(0, 5, 0, 35)
ContentFrame.Size = UDim2.new(1, -10, 1, -40)
ContentFrame.CanvasSize = UDim2.new(0, 0, 2, 0)
ContentFrame.ScrollBarThickness = 4

UIListLayout.Parent = ContentFrame
UIListLayout.Padding = UDim.new(0, 5)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Helper functions for creating elements
local function CreateButton(text, callback)
    local btn = Instance.new("TextButton")
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.Size = UDim2.new(1, 0, 0, 35)
    btn.Font = Enum.Font.Gotham
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 14
    btn.Parent = ContentFrame
    btn.MouseButton1Click:Connect(callback)
    return btn
end

local function CreateToggle(text, callback)
    local enabled = false
    local btn = CreateButton(text .. ": OFF", function()
        enabled = not enabled
        callback(enabled)
    end)
    
    local originalCallback = callback
    callback = function(val)
        enabled = val
        btn.Text = text .. ": " .. (enabled and "ON" or "OFF")
        btn.BackgroundColor3 = enabled and Color3.fromRGB(80, 80, 80) or Color3.fromRGB(50, 50, 50)
        originalCallback(val)
    end
    
    -- Update the button to use the new logic
    btn.MouseButton1Click:DisconnectAll()
    btn.MouseButton1Click:Connect(function()
        enabled = not enabled
        callback(enabled)
    end)
    
    return btn
end

-- Desync Visuals
local function CreateServerPosVisual(pos)
    if ServerPosPart then ServerPosPart:Destroy() end
    local character = game.Players.LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end

    ServerPosPart = Instance.new("Part")
    ServerPosPart.Name = "ServerPositionVisual"
    ServerPosPart.Size = Vector3.new(2, 6, 2)
    ServerPosPart.Color = Color3.fromRGB(255, 255, 255)
    ServerPosPart.Material = Enum.Material.Neon
    ServerPosPart.Anchored = true
    ServerPosPart.CanCollide = false
    ServerPosPart.Position = pos or character.HumanoidRootPart.Position
    ServerPosPart.Parent = game.Workspace
    
    local BillboardGui = Instance.new("BillboardGui")
    BillboardGui.Size = UDim2.new(0, 200, 0, 50)
    BillboardGui.Adornee = ServerPosPart
    BillboardGui.AlwaysOnTop = true
    BillboardGui.ExtentsOffset = Vector3.new(0, 3, 0)
    BillboardGui.Parent = ServerPosPart
    
    local TextLabel = Instance.new("TextLabel")
    TextLabel.Size = UDim2.new(1, 0, 1, 0)
    TextLabel.BackgroundTransparency = 1
    TextLabel.Text = "Checkpoint / Server Pos"
    TextLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
    TextLabel.TextStrokeTransparency = 0
    TextLabel.TextSize = 20
    TextLabel.Font = Enum.Font.GothamBold
    TextLabel.Parent = BillboardGui
end

-- Feature Implementation
CreateToggle("Desync", function(state)
    DesyncEnabled = state
    if DesyncEnabled then
        CreateServerPosVisual()
        task.spawn(function()
            local hb = game:GetService("RunService").Heartbeat
            while DesyncEnabled do
                local char = game.Players.LocalPlayer.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    local oldVelocity = char.HumanoidRootPart.Velocity
                    char.HumanoidRootPart.Velocity = Vector3.new(0, -500, 0)
                    hb:Wait()
                    char.HumanoidRootPart.Velocity = oldVelocity
                end
                task.wait()
            end
        end)
    else
        if ServerPosPart then ServerPosPart:Destroy() end
    end
end)

CreateButton("Update Visual Position", function()
    if DesyncEnabled then CreateServerPosVisual() end
end)

CreateButton("Save Checkpoint", function()
    local character = game.Players.LocalPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        SavedCheckpoint = character.HumanoidRootPart.Position
        CreateServerPosVisual(SavedCheckpoint)
    end
end)

CreateToggle("Instant Teleport (Bypass)", function(state)
    TeleportActive = state
    if TeleportActive then
        task.spawn(function()
            while TeleportActive do
                local character = game.Players.LocalPlayer.Character
                if character and character:FindFirstChild("HumanoidRootPart") and SavedCheckpoint then
                    local hasBrainrot = false
                    for _, v in pairs(character:GetChildren()) do
                        if v.Name:lower():find("brainrot") then
                            hasBrainrot = true
                            break
                        end
                    end
                    
                    if hasBrainrot then
                        local backpack = game.Players.LocalPlayer.Backpack
                        local carpet = backpack:FindFirstChild("Flying Carpet") or character:FindFirstChild("Flying Carpet")
                        
                        if carpet then
                            if carpet.Parent == backpack then
                                carpet.Parent = character
                            end
                            task.wait(0.1)
                            character.HumanoidRootPart.Velocity = Vector3.new(0, 1, 0)
                            character.HumanoidRootPart.CFrame = CFrame.new(SavedCheckpoint)
                            break
                        end
                    end
                end
                task.wait(0.5)
            end
        end)
    end
end)
