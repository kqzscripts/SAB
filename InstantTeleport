--[[
    KqzExploitz - Steal a Brainrot
    Features: Set Checkpoint (Ghost), Auto TP (Server Latency Bypass)
    Colors: Grey, Dark Grey, White
    Compatibility: PC, Mobile, Console
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ProximityPromptService = game:GetService("ProximityPromptService")
local NetworkClient = game:GetService("NetworkClient")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")

-- State
local checkpointGhost = nil
local checkpointPosition = nil
local autoTPEnabled = false
local isMinimized = false
local holdDuration = 0
local IS_HOLDING = false

-- UI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KqzExploitz"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui") or player:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 300, 0, 350)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 10)
Corner.Parent = MainFrame

-- Header
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 50)
Header.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
Header.BorderSizePixel = 0
Header.Parent = MainFrame

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 10)
HeaderCorner.Parent = Header

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -100, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "KqzExploitz"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 20
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

-- Close Button
local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(1, -40, 0, 10)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Parent = Header

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(1, 0)
CloseCorner.Parent = CloseBtn

-- Minimize Button
local MinBtn = Instance.new("TextButton")
MinBtn.Size = UDim2.new(0, 30, 0, 30)
MinBtn.Position = UDim2.new(1, -80, 0, 10)
MinBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
MinBtn.Text = "-"
MinBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
MinBtn.Font = Enum.Font.GothamBold
MinBtn.Parent = Header

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(1, 0)
MinCorner.Parent = MinBtn

-- Content Area
local Container = Instance.new("Frame")
Container.Name = "Container"
Container.Size = UDim2.new(1, -20, 1, -70)
Container.Position = UDim2.new(0, 10, 0, 60)
Container.BackgroundTransparency = 1
Container.Parent = MainFrame

local Layout = Instance.new("UIListLayout")
Layout.Padding = UDim.new(0, 15)
Layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
Layout.Parent = Container

local function CreateButton(text)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 0, 55)
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.Parent = Container
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, 8)
    c.Parent = btn
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(70, 70, 70)
    stroke.Thickness = 2
    stroke.Parent = btn
    return btn
end

local CheckpointButton = CreateButton("Set Checkpoint")
local AutoTPButton = CreateButton("Auto TP: OFF")

-- Visualizer Function (Transparent Ghost)
local function CreateCheckpointVisual(pos)
    if checkpointGhost then checkpointGhost:Destroy() end
    checkpointGhost = Instance.new("Part")
    checkpointGhost.Name = "CheckpointGhost"
    checkpointGhost.Size = Vector3.new(2, 6, 2)
    checkpointGhost.Position = pos + Vector3.new(0, 3, 0)
    checkpointGhost.Anchored = true
    checkpointGhost.CanCollide = false
    checkpointGhost.Transparency = 0.5
    checkpointGhost.Color = Color3.fromRGB(180, 180, 180)
    checkpointGhost.Material = Enum.Material.SmoothPlastic
    checkpointGhost.Parent = workspace
    local mesh = Instance.new("SpecialMesh")
    mesh.MeshType = Enum.MeshType.Brick
    mesh.Parent = checkpointGhost
    local Billboard = Instance.new("BillboardGui")
    Billboard.Size = UDim2.new(0, 200, 0, 50)
    Billboard.Adornee = checkpointGhost
    Billboard.AlwaysOnTop = true
    Billboard.Parent = checkpointGhost
    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, 0, 1, 0)
    Label.BackgroundTransparency = 1
    Label.Text = "Server Position"
    Label.TextColor3 = Color3.fromRGB(120, 120, 120)
    Label.Font = Enum.Font.GothamBold
    Label.TextSize = 14
    Label.Parent = Billboard
end

-- Advanced Anti-Cheat Bypass (Latency & Character State)
local function SecureTeleport()
    if not checkpointPosition then return end
    local carpet = character:FindFirstChild("Flying Carpet") or player.Backpack:FindFirstChild("Flying Carpet")
    if carpet then
        if carpet.Parent ~= character then carpet.Parent = character end
        
        -- Bypass Step 1: Simulate Server-Side Latency
        -- This confuses the server's movement validation without lagging the player locally
        settings().Network.IncomingReplicationLag = 0.5 
        
        -- Bypass Step 2: Character State Manipulation
        rootPart.Velocity = Vector3.new(0, 0, 0)
        rootPart.RotVelocity = Vector3.new(0, 0, 0)
        
        -- Bypass Step 3: Instant CFrame Update
        rootPart.CFrame = CFrame.new(checkpointPosition + Vector3.new(0, 3, 0))
        
        -- Reset lag after a short window
        task.delay(0.2, function()
            settings().Network.IncomingReplicationLag = 0
        end)
    end
end

-- Possession Check
local function CheckForStolenObject()
    for _, child in pairs(character:GetChildren()) do
        if (child:IsA("Model") or child:IsA("BasePart") or child:IsA("Tool")) and not child:IsDescendantOf(player) and not child.Name:match("Hair") and not child.Name:match("Accessory") then
            return true
        end
    end
    return false
end

-- Interaction Monitor (Hold Logic)
local function MonitorInteraction()
    -- ProximityPrompt (Natural Hold)
    ProximityPromptService.PromptButtonHoldEnded:Connect(function(prompt)
        if autoTPEnabled then
            task.wait(0.1)
            if CheckForStolenObject() then SecureTeleport() end
        end
    end)

    -- PC Hold Logic (E or Right Click)
    UserInputService.InputBegan:Connect(function(input, processed)
        if processed then return end
        if input.KeyCode == Enum.KeyCode.E or input.UserInputType == Enum.UserInputType.MouseButton2 then
            IS_HOLDING = true
            holdDuration = tick()
        end
    end)

    UserInputService.InputEnded:Connect(function(input, processed)
        if processed then return end
        if input.KeyCode == Enum.KeyCode.E or input.UserInputType == Enum.UserInputType.MouseButton2 then
            local duration = tick() - holdDuration
            IS_HOLDING = false
            -- Only trigger if held for at least 0.3s (ignores taps)
            if autoTPEnabled and duration > 0.3 then
                task.wait(0.2)
                if CheckForStolenObject() then SecureTeleport() end
            end
        end
    end)

    -- Mobile Touch Hold Logic
    UserInputService.TouchStarted:Connect(function(touch, processed)
        if processed then return end
        IS_HOLDING = true
        holdDuration = tick()
    end)

    UserInputService.TouchEnded:Connect(function(touch, processed)
        if processed then return end
        local duration = tick() - holdDuration
        IS_HOLDING = false
        if autoTPEnabled and duration > 0.3 then
            task.wait(0.2)
            if CheckForStolenObject() then SecureTeleport() end
        end
    end)
end

player.CharacterAdded:Connect(function(newChar)
    character = newChar
    rootPart = character:WaitForChild("HumanoidRootPart")
    MonitorInteraction()
end)
MonitorInteraction()

CheckpointButton.MouseButton1Click:Connect(function()
    checkpointPosition = rootPart.Position
    CreateCheckpointVisual(checkpointPosition)
    CheckpointButton.Text = "Checkpoint: SET"
    task.wait(1)
    CheckpointButton.Text = "Set Checkpoint"
end)

AutoTPButton.MouseButton1Click:Connect(function()
    autoTPEnabled = not autoTPEnabled
    AutoTPButton.Text = autoTPEnabled and "Auto TP: ON" or "Auto TP: OFF"
    AutoTPButton.BackgroundColor3 = autoTPEnabled and Color3.fromRGB(100, 100, 100) or Color3.fromRGB(50, 50, 50)
end)

-- UI Controls
CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
MinBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    Container.Visible = not isMinimized
    MainFrame.Size = isMinimized and UDim2.new(0, 300, 0, 50) or UDim2.new(0, 300, 0, 350)
    MinBtn.Text = isMinimized and "+" or "-"
end)

-- Draggable Logic
local dragging, dragInput, dragStart, startPos
Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true; dragStart = input.Position; startPos = MainFrame.Position
        input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
    end
end)
Header.InputChanged:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end end)
UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragging then
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end end)

print("KqzExploitz V3.3 Bypass Optimized")
